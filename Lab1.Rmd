---
title: "W203 Lab Assignment 1"
author: "Felipe Campos, Josh Wilson and Stanimir Vichev"
date: "1/27/2017"
output:
  html_document: default
  pdf_document: default
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Introduction
Introduction to the report

## Loading the Data 
```{r ceo}
load("ceo_w203.RData")
```

# Some general info on the dataset
# Different views of the dataset
```{r}
# Different views of the dataset
head(CEO)
str(CEO)
```

# Packages used in analysis
```{r,echo =FALSE}
library("ggplot2")
install.packages("car")
library("car")
install.packages("e1071")
library(e1071)
```

Cleaning up data
```{r}
CEO$mktval[CEO$mktval == -1] <- NA
CEO$profits[CEO$profits == -1] <- NA
CEO_complete <- CEO[complete.cases(CEO),]
```

## Univariate Analysis of the Dataset

# Histogram plot of the independent variable, salary

```{r}
salary_hist <- ggplot(data = CEO_complete, aes(x = salary))
salary_hist + geom_histogram(bins = 40)
```
The histogram of the dependent variable salary uncovers two important features about the salary sample. First, the distribution has a positive skew, with many salaries bunched into bins between 500 and 1000 and a long tail towards the right. Second, there are two or more possible outliers. From this evidence, we believe that distribution for salary is non-normal and may require transformation, especially if we are to use models that assume normally distributed variables.

# Histogram plot of mktval, first dependent variable

A lot of companies are on the lower spectrum of market values, with a gradual decrease in the number of companies with higher market values. This is in line with our normal assumptions about the distribution of companies in the stock market. The mean and the median are quite close because the outliers to the right are offset by the large number of companies with low market value.
```{r}
mktval_hist <- ggplot(data = CEO_complete, aes(x = log10(mktval)))
mktval_hist + geom_histogram(bins = 40)
hist(log10(CEO_complete$mktval), breaks = 40)
#lines(density(log10(CEO_complete$mktval)))
abline(v = mean(log10(CEO_complete$mktval)), col = "red")
abline(v = median(log10(CEO_complete$mktval)), col = "royalblue")
```

A lot of companies are on the lower spectrum of market values, with a gradual decrease in the number of companies with higher market values. This is in line with our normal assumptions about the distribution of companies in the stock market. The mean and the median are quite close because the outliers to the right are offset by the large number of companies with low market value.

# Histogram plot of profits, the other key dependent variable

We applied a log10 scale and added 500 to shift everything to the right. As profits can be negative, we don't see that much of a positive skew in this graph. There are again outliers present on both sides, with a lot of companies with profits around 500. The standard deviation of profits is 401, which explains why the distribution is so wide.
```{r}
# first way
profits_hist <- ggplot(data = CEO_complete, aes(x = log10(profits + 500)))
profits_hist + geom_histogram(bins = 40)

# second way
hist(log10(CEO_complete$profits+500), breaks = 40)
abline(v = mean(log10(CEO_complete$profits+500)), col = "red")
abline(v = median(log10(CEO_complete$profits+500)), col = "royalblue")

# without log
hist(CEO_complete$profits+500, breaks = 40)
abline(v = mean(CEO_complete$profits+500), col = "red")
abline(v = median(CEO_complete$profits+500), col = "royalblue")

sd(CEO_complete$profits)
```



```{r}
age_hist <- ggplot(data = CEO_complete, aes(x = age))
age_hist + geom_histogram(bins = 60)
kurtosis(CEO_complete$age)
mean(CEO_complete$age)
sd(CEO_complete$age)
```

The distribution of age in the sample looks fairly normal, except for the distinct peak at the center. From the kurtosis calculation, we might say this sample has more in common with a logistic distribution than a normal distribution. Of course, this is only a sample of 185, and we might find that kurtosis will approach 0 as the sample grows. However, it is likely that the lack of heavy tails is an important feature of CEO age, because we see the sparseness in CEOs below 30 and over 75. We could easily come up with an ad hoc story suggesting that CEOs below 30 don't have the requisite experience and CEOs above 75 cannot handle the rigors of the job. Another view would be to label points above 75 and below 30 as outliers, but this would be hasty without further information. We note that the mean is fairly high at 55 years old and the standard deviation is also rather large at 9.5.

# Univariate analysis of education
```{r}
table(CEO_complete$college)

table(CEO_complete$grad)
```
For categorical variables such as college and grad, we examined their frequency distribution using tables. Evident from the table with the college variable, less than 4% of the CEOs in the sample didn't graduate from college. It would seem that post-secondary education is a necessary attribute for a CEO; this is not a surprising attribute of the data since performance in school tends to be an indicator of work ethics and/or intelligence. Moreover, boards that choose CEOs tend to prefer credentialed individuals as a means of mitigating risk. Meanwhile, the split between college and a post-tertiary degree are much closer. There is less evidence to suggest that a graduate degree confers much additional advantage in becoming a CEO. Although the more interesting comparisons would be the education of CEOs to the average education of the population. We believe that CEOs represent a group of highly educated people in comparison to the average population.

# Univariate Examination of ComTen and CEOTen
```{r}
ten_ceo_hist <- ggplot(data = CEO_complete) + 
  geom_histogram(aes(x = comten, fill = "comten"), alpha = 0.3, position = "identity") +
  geom_histogram(aes(x = ceoten, fill = "ceoten"), alpha = 0.3, position = "identity") + 
  scale_fill_manual(values = c(comten = "red", ceoten = "green")) +
  theme(legend.position = c(1,1), legend.justification= c(1,1), legend.background = element_blank(),
        plot.title = element_text(hjust = .5)) +
  labs(title = "Years as CEO and Years at Company", fill = "Tenure Type") + xlab("Years") + ylab("Count") + 
  geom_vline(aes(xintercept=mean(comten)), colour = "red", linetype = "dashed") +
  geom_vline(aes(xintercept=mean(ceoten)), colour = "green", linetype = "dashed")
ten_ceo_hist
```


# Bivariate Relationship Analysis

Going through the relationshiops of salary with all of the independent variables one-by-one and giving some initial thoughts.


# Scatterplot matrix of key variables
```{r}
scatterplotMatrix( ~ salary + profits + mktval, data = CEO_complete, diagonal = "histogram")

scatterplotMatrix( ~ salary + profits + mktval + age + college + grad + comten + ceoten, data = CEO_complete, diagonal = "histogram") # prettier
```


# Salary and Age

1. There seems to be a slight positive correlation between age and salary. If you are an older person who is a CEO, you are more likely to be paid more. We should also note that we have some very old people, >70, who are paid very little. It is possible they are CEOs in name only, or have small firms, or some other explanation.
```{r}
plot(CEO_complete$age, CEO_complete$salary)
abline(lm(CEO_complete$salary ~ CEO_complete$age))
```

# Salary and College

2. A lot more people who are CEOs went to college vs. not. Not enough data points for no-college CEOs to really compare the distributions.
```{r}
plot(CEO_complete$college, CEO_complete$salary)
```

# Salary vs. grad school

3. Salary doesn't seem to be impacted by whether you attended grad school or not. The outliers in salary are two people who didn't go to grad school.
```{r}
plot(CEO_complete$grad, CEO_complete$salary)
```

# Salary vs. Comten

4. This one looks pretty random, small positive relationship
```{r}
plot(CEO_complete$comten, CEO_complete$salary)
abline(lm(CEO_complete$salary ~ CEO_complete$comten))
```

# Salary vs. CeoTen

5. This one also looks pretty random, although slightly positive.
```{r}
plot(CEO_complete$ceoten, CEO_complete$salary)
abline(lm(CEO_complete$salary ~ CEO_complete$ceoten))
```

# Salary vs. Profits

6. There is a lot of bunching around 0, making this graph tough to analzye. Note that salary can be quite high regardless of company profits.
```{r}
plot(CEO_complete$salary, CEO_complete$profits)
abline(lm(CEO_complete$salary ~ CEO_complete$profits))
```

# Salary vs. Mktval

7. Market val and profits seem linearly related. We might want to transform both of these variables.
```{r}
plot(CEO_complete$mktval, CEO_complete$profits)
abline(lm(CEO_complete$profits ~ CEO_complete$mktval))
```

8. Appears to be that the more education a person has, the likelier they are to be the head of a company with a higher market value.

9. Between 50 and 70 years old is when companies with high market values choose you to be CEO.

10. It seems that CEOs are likely to be selected from inside a company. In comten vs. ceoten, many of the data points lie above the 45 degree line, meaning they were with the company longer than their CEO tenure.

# Transforming the dependent variable
```{r}
log_salary_hist <- ggplot(data = CEO, aes(x = log(salary, base = 10)))
log_salary_hist + geom_histogram(bins = 30)
```

Now we seem to have a more normal looking distribution. We still have some outliers, but they are now significantly closer to the central tendency.

# Log Transforming mktval and profits
```{r}
profit_hist <- ggplot(data = CEO, aes(x = profits))
profit_hist + geom_histogram() # Notice some negative values

range(CEO$profits)
log_profit_hist <-  ggplot(data = CEO, aes(x = log((profits+464),base=10)))
log_profit_hist + geom_histogram(bins = 40)
```

11. Graduate school doesn't seem to affect salary that much.
```{r}
ggplot(data = CEO, aes(x = factor(college), y = salary) )+ geom_boxplot()
ggplot(data = CEO, aes(x = factor(grad), y = salary) )+ geom_boxplot()
```

12. There are a lot of companies with low positive profits and low market value.
```{r}
hist(log(CEO_complete$profits+500, base = 10), breaks = 80)
table(CEO$profits)
plot(log(CEO_complete$profits, base = 10), log(CEO_complete$mktval, base =10))
```

13. Are bonuses included in the salaries?

14. In a log scale relationship between profit(x) and salary(y) almost linear (apart from kink). In a log scale relationship between mktval(x) and salary(y) is very linear.
```{r}
ggplot(data = CEO_complete, aes(x=log10(profits), y=log10(salary))) + geom_point() + geom_smooth()
ggplot(data = CEO_complete, aes(x=log10(mktval), y=log10(salary))) + geom_point() + geom_smooth()
```

15. If you plot log mktval(y) and salary(x), you see some outliers that really affect smooth line. Low salary, high mktval could be someone that gets all his money from bonuses/shares, not salary.
```{r}
ggplot(data = CEO_complete, aes(x=log10(salary), y=log10(mktval))) + geom_point() + geom_smooth()
```

16. Rich CEO might be interesting to look at 
```{r}
richCEO= subset( CEO,salary > 4000)
summary(richCEO)
```

17. It is hard to judge company performance from just a single year of data.

TODO:
Intro and Conclusion
Make graphs prettier
Thorough univariate analysis of each key variable - look at age, comten, ceoten.
Analysis of potential confounding effects - calculating mktval may include profits within it, so this could be one such effect.
Explain in detail handling of -1s: While investigating the quality of the profits variable, we found several negative values. It is reasonable that there would be negative values, as some companies are in a growth phase and spend more than their revenues. However, a preponderance of -1 values suggested that these values may have been coded as such to indicate a missing value. No other profit value is repeated (check on this), so the mere fact that we have X number of -1 values would be evidence of a coding matter.

